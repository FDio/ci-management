- project:
    name: csit-vpp-functional
    description: 'Run VPP functional tests on VIRL.'

    jobs:
        - 'csit-vpp-perf-hw-{type}'
        - 'csit-vpp-functional-virl'
        - 'csit-vpp-verify-weekly'
        - 'csit-vpp-master-verify-semiweekly'

    project: 'csit'
    branch: 'master'
    type:
        - all

- job-template:
    name: 'csit-vpp-functional-virl'

    project-type: freestyle
    node: verify
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: '{ssh-credentials}'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    triggers:
        - gerrit-trigger-patch-submitted:
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell:
            !include-raw-escape include-raw-csit-vpp-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'report.html, log.html, output.xml'
            latest-only: false

        - robot-report:
            output-path: ''

- job-template:
    name: 'csit-vpp-perf-hw-{type}'

    project-type: freestyle
    node: verify
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - type-parameter:
            type: '{type}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: '{ssh-credentials}'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'verify-perf-{type}'

    builders:
        - shell:
            !include-raw-escape jjb/csit/include-raw-csit-vpp-perf-hw.sh

    publishers:
        - archive-artifacts:
            artifacts: 'report.html, log.html, output.xml'
            latest-only: false

        - robot-report:
            output-path: ''

- job-template:
    name: 'csit-vpp-verify-weekly'

    project-type: freestyle
    node: verify
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            branch: 'master'

    wrappers:
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    triggers:
        - timed: '0 4 * * 0'

        - gerrit-trigger-manually-triggered:
            comment-trigger-value: 'csit-vpp-ref-verify'
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell:
            !include-raw-escape jjb/csit/include-raw-csit-vpp-verify-weekly.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/report.html, csit/log.html, csit/output.xml'
            latest-only: false

        - robot-report:
            output-path: 'csit'

        - git:
               push-only-if-success: true
               tags:
                   - tag:
                       remote: origin
                       name: "csit-verified"
                       message: "Verified CSIT version for VPP testing"
                       create-tag: true
                       update-tag: true

- job-template:
    name: 'csit-vpp-master-verify-semiweekly'

    project-type: freestyle
    node: verify
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - git-scm:
            credentials-id: '{ssh-credentials}'
            branch: 'master'

    wrappers:
        - ssh-agent-credentials:
            users:
                - '{ssh-credentials}'

    triggers:
        - timed: '0 4 * * 2,6'

        - gerrit-trigger-manually-triggered:
            comment-trigger-value: 'csit-verify-vpp'
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell:
            !include-raw-escape jjb/csit/include-raw-csit-vpp-master-verify-semiweekly.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/report.html, csit/log.html, csit/output.xml'
            latest-only: false

        - robot-report:
            output-path: 'csit'

- parameter:
    name: test-type-parameter

    parameters:
        - string:
            name: TYPE
            default: '{type}'
            description: "Test TYPE parameter if not given by trigger"
