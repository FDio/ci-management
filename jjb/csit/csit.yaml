# Copyright (c) 2018 Cisco and/or its affiliates.
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at:
#
#     http://www.apache.org/licenses/LICENSE-2.0
#
# Unless required by applicable law or agreed to in writing, software
# distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and
# limitations under the License.


- project:
    name: csit
    description: 'CSIT jenkins jobs.'
    os:
        - 'ubuntu1604'
        - 'centos7'
    topo:
        - '2n'
        - '3n'

    arch:
        - 'skx'
        - 'hsw'
        - 'arm'

    jobs:
        - 'csit-vpp-functional-{stream}-{os}-virl'
        - 'csit-vpp-verify-{stream_timed}-{os}-weekly'
        - 'csit-vpp-verify-{stream_timed}-{os}-semiweekly'
        - 'csit-docs-merge-{stream_timed}'
        - 'csit-docs-verify-{stream}'
        - 'csit-report-merge-{stream}'
        - 'csit-trending-daily-master'
        - 'csit-dpdk-perf-verify-{stream}-{topo}-{arch}'
        - 'csit-dpdk-perf-mrr-weekly-master'
        - 'csit-dpdk-perf-mrr-weekly-master-2n-skx'
        - 'csit-dpdk-perf-mrr-weekly-master-3n-skx'
        - 'csit-ligato-perf-{stream}-{type}'
        - 'csit-vpp-perf-mrr-daily-master'
        - 'csit-vpp-perf-mrr-daily-master-2n-skx'
        - 'csit-vpp-perf-mrr-daily-master-3n-skx'
        - 'csit-vpp-perf-ndrpdr-weekly-master-3n-hsw'
        - 'csit-vpp-perf-ndrpdr-weekly-master-2n-skx'
        - 'csit-vpp-perf-ndrpdr-weekly-master-3n-skx'
        - 'csit-vpp-perf-verify-{stream}-{topo}-{arch}'
        - 'csit-nsh_sfc-verify-perf-{stream}'
        - 'csit-nsh_sfc-verify-func-{stream}-{os}-virl'
        - 'csit-tldk-verify-func-{stream}-{os}-virl'
        - 'csit-dmm-functional-{stream}-ubuntu1604-virl'

    project: 'csit'
    branch: 'master'
    branch-id: 'oper'
    build-artifact-num-to-keep: 10
    type:
        - all
    stream_timed:
        - master:
            branch: 'master'
            branch-id: 'oper'
    stream:
        - master:
            branch: 'master'
            branch-id: 'oper'
        - '1801':
            branch: 'rls1801'
            branch-id: 'oper-rls1801'
        - '1804':
            branch: 'rls1804'
            branch-id: 'oper-rls1804'
        - '1807':
            branch: 'rls1807'
            branch-id: 'oper-rls1807'


- job-template:
    name: 'csit-vpp-functional-{stream}-{os}-virl'

    project-type: freestyle
    node: '{os}-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-patch-submitted:
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell:
            !include-raw-escape: include-raw-csit-vpp-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'report.html, log.html, output.xml'
            latest-only: false

        - robot-report:
            output-path: ''

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-dpdk-perf-verify-{stream}-{topo}-{arch}'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>perf verify - per csit gerrit patch
              </ul>
          <li>job
              <ul>
                  <li>name: <b>csit-dpdk-perf-verify-{stream}-{topo}-{arch}</b>
                  <li>trigger: keyword in comment to csit patch:
                      <b>csit-dpdk-{topo}-{arch}-perftest tag_list</b>
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>test-cases selected using trigger keyword followed by tags
                  <li>all test-cases are labelled with CSIT RF topic tags
                      defined in <i>csit/docs/tag_documentation.rst</i>
              </ul>
          <li>default tags for dpdk perf test type
              <ul>
                  <li>IP4BASE, L2XCBASE
                  <li>64B: 64B packet size
                  <li>1C: one core
                  <li>X710: x710 Fortville NIC
                  <li>MRR: MRR throughput
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: no
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit:
            server-name: 'Primary'
            trigger-on:
                - comment-added-contains-event:
                    comment-contains-value: 'csit-dpdk-{topo}-{arch}-perftest'
            projects:
              - project-compare-type: 'ANT'
                project-pattern: '{project}'
                branches:
                  - branch-compare-type: 'ANT'
                    branch-pattern: '**/{branch}'
            skip-vote:
                successful: false
                failed: false
                unstable: false
                notbuilt: false

    builders:
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-verify.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot:
            output-path: archive
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-ligato-perf-{stream}-{type}'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - type-parameter:
            type: '{type}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'verify-perf-ligato-{type}'

    builders:
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-verify.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot:
            output-path: archive
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'


- job-template:
    name: 'csit-vpp-verify-{stream_timed}-{os}-weekly'
    description: 'Purpose of this job is to validate CSIT code of corresponding branch against verified vpp build from corresponding branch.'

    project-type: freestyle
    node: '{os}-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - git-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 4 * * 0'

        - gerrit-trigger-manually-triggered:
            comment-trigger-value: 'csit-vpp-ref-verify'
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-vpp-verify-weekly.sh

    publishers:
        - archive-artifacts:
            artifacts: 'report.html, log.html, output.xml'
            latest-only: false

        - robot-report:
            output-path: ''

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-verify-{stream_timed}-{os}-semiweekly'
    description: 'Purpose of this job is to validate latest vpp build from corresponding branch stored in nexus against verified CSIT codebase of corresponding branch.'

    project-type: freestyle
    node: '{os}-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 4 * * 2,6'

        - gerrit-trigger-manually-triggered:
            comment-trigger-value: 'csit-verify-vpp'
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-vpp-verify-semiweekly.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot-report:
            output-path: 'csit/archive'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-verify-{stream_timed}-centos7-nightly'
    description: 'Purpose of this job is to validate latest centos7 vpp build from corresponding branch stored in nexus against verified CSIT codebase of corresponding branch.'

    project-type: freestyle
    node: centos7-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - git-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: 'H H(3-4) * * *'

        - gerrit-trigger-manually-triggered:
            comment-trigger-value: 'vpp-verify-func-centos7'
            name: '{project}'
            branch: '{branch}'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-vpp-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot-report:
            output-path: 'csit/archive'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-docs-verify-{stream}'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - maven-exec:
            maven-version: 'mvn33-new'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-patch-submitted:
            name: '{project}'
            branch: '{branch}'

    builders:
        - maven-target:
            maven-version: 'mvn33-new'
            goals: '--version'
            settings: 'csit-settings'
            settings-type: cfp
            global-settings: 'global-settings'
            global-settings-type: cfp
        - provide-maven-settings:
            settings-file: 'csit-settings'
            global-settings-file: 'global-settings'
        - shell:
            !include-raw-escape: include-raw-csit-docs.sh

    publishers:
        - archive:
            artifacts: 'resources/tools/doc_gen/csit.docs.tar.gz'
            allow-empty: 'true'
            fingerprint: false
            only-if-success: true
            default-excludes: false

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-docs-merge-{stream_timed}'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - maven-exec:
            maven-version: 'mvn33-new'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: ''
            choosing-strategy: 'default'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - reverse:
            jobs: 'csit-vpp-verify-{stream_timed}-ubuntu1604-weekly'
            result: 'success'
        - gerrit:
            server-name: 'Primary'
            trigger-on:
                - comment-added-contains-event:
                    comment-contains-value: 'run-docs'
            projects:
              - project-compare-type: 'ANT'
                project-pattern: '{project}'
                branches:
                  - branch-compare-type: 'ANT'
                    branch-pattern: '**/{branch}'
            skip-vote:
                successful: true
                failed: true
                unstable: true
                notbuilt: true

    builders:
        - maven-target:
            maven-version: 'mvn33-new'
            goals: '--version'
            settings: 'csit-settings'
            settings-type: cfp
            global-settings: 'global-settings'
            global-settings-type: cfp
        - provide-maven-settings:
            settings-file: 'csit-settings'
            global-settings-file: 'global-settings'
        - shell:
            !include-raw-escape: include-raw-csit-docs.sh

    publishers:
        - archive:
            artifacts: 'resources/tools/doc_gen/csit.docs.tar.gz'
            allow-empty: 'true'
            fingerprint: false
            only-if-success: true
            default-excludes: false

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-report-merge-{stream}'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-8c-32g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - maven-exec:
            maven-version: 'mvn33-new'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'default'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit:
            server-name: 'Primary'
            trigger-on:
                - comment-added-contains-event:
                    comment-contains-value: 'run-report'
            projects:
              - project-compare-type: 'ANT'
                project-pattern: '{project}'
                branches:
                  - branch-compare-type: 'ANT'
                    branch-pattern: '**/{branch}'
            skip-vote:
                successful: true
                failed: true
                unstable: true
                notbuilt: true

    builders:
        - maven-target:
            maven-version: 'mvn33-new'
            goals: '--version'
            settings: 'csit-settings'
            settings-type: cfp
            global-settings: 'global-settings'
            global-settings-type: cfp
        - provide-maven-settings:
            settings-file: 'csit-settings'
            global-settings-file: 'global-settings'
        - shell:
            !include-raw-escape: include-raw-csit-report.sh

    publishers:
        - archive:
            artifacts: 'resources/tools/presentation/csit.report.tar.gz'
            allow-empty: 'true'
            fingerprint: false
            only-if-success: true
            default-excludes: false

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-trending-daily-master'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-8c-32g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - maven-exec:
            maven-version: 'mvn33-new'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: ''
            choosing-strategy: 'default'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - reverse:
            jobs: 'csit-vpp-perf-mrr-daily-master'
            result: 'failure'

    builders:
        - maven-target:
            maven-version: 'mvn33-new'
            goals: '--version'
            settings: 'csit-settings'
            settings-type: cfp
            global-settings: 'global-settings'
            global-settings-type: cfp
        - provide-maven-settings:
            settings-file: 'csit-settings'
            global-settings-file: 'global-settings'
        - shell:
            !include-raw-escape: include-raw-csit-cpta.sh

    publishers:
        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-ndrpdr-weekly-master-3n-hsw'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf ndrpdr weekly on 3n-hsw
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>pre-selected CSIT VPP NDRPDR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>
    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-ndrpdr-weekly-master-2n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf ndrpdr weekly
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>pre-selected CSIT VPP NDRPDR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>
    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-ndrpdr-weekly-master-3n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf ndrpdr weekly
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>pre-selected CSIT VPP NDRPDR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>
    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-mrr-daily-master'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf mrr daily
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT VPP MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 2,16 * * *'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-mrr-daily-master-2n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf mrr daily
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT VPP MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 2,16 * * *'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-vpp-perf-mrr-daily-master-3n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check vpp perf mrr daily
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT VPP MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 2,16 * * *'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-dpdk-perf-mrr-weekly-master'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check dpdk perf mrr weekly
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT DPDK MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-dpdk-perf-mrr-weekly-master-2n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check dpdk perf mrr weekly
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT DPDK MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-dpdk-perf-mrr-weekly-master-3n-skx'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>check dpdk perf mrr weekly
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>all CSIT DPDK MRR perf suites
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: csit project (catch malfunctions/degradations)
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: false

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - timed: '0 0 * * 6'

    builders:
        - shell: 'echo "BRANCH_ID={branch-id}" > $WORKSPACE/variables.prop'
        - inject:
            properties-file: variables.prop
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-timed.sh

    publishers:
        - archive-artifacts:
            artifacts: 'csit/archive/*.*'
            latest-only: false

        - robot:
            output-path: 'csit/archive'
            other-files:
              - '*.*'

        - trigger:
            project: 'csit-trending-daily-master'
            threshold: 'FAILURE'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'


- job-template:
    name: 'csit-vpp-perf-verify-{stream}-{topo}-{arch}'

    description: |
      <ul>
          <li>objective
              <ul>
                  <li>perf verify - per csit gerrit patch
              </ul>
          <li>job
              <ul>
                  <li>name: <b>csit-vpp-perf-verify-{stream}-{topo}-{arch}</b>
                  <li>trigger: keyword in comment to csit patch:
                      <b>csit-{topo}-{arch}-perftest tag_list</b>
              </ul>
          <li>perf test-cases selection
              <ul>
                  <li>test-cases selected using trigger keyword followed by tags
                  <li>all test-cases are labelled with CSIT RF topic tags
                      defined in <i>csit/docs/tag_documentation.rst</i>
              </ul>
          <li>proposed keywords
              <ul>
                  <li>focus on testing specified vpp packet processing path
                  <li>format: csit-{topo}-{arch}-perftest tag_list
              </ul>
          <li>default tags for vpp startup config and perf test type
              <ul>
                  <li>IP4BASE, IP6BASE, L2BDBASE
                  <li>64B/78B: 64B/78B packet size
                  <li>1C: one core
                  <li>X710: x710 Fortville NIC
                  <li>MRR: MRR throughput
              </ul>
          <li>results
              <ul>
                  <li>jjb verify: PASS/FAIL
                  <li>present: no
                  <li>analyse: no
              </ul>
      </ul>

    project-type: freestyle
    node: 'ubuntu1604-basebuild-8c-32g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit:
            server-name: 'Primary'
            trigger-on:
                - comment-added-contains-event:
                    comment-contains-value: 'csit-{topo}-{arch}-perftest'
            projects:
              - project-compare-type: 'ANT'
                project-pattern: '{project}'
                branches:
                  - branch-compare-type: 'ANT'
                    branch-pattern: '**/{branch}'
            skip-vote:
                successful: false
                failed: false
                unstable: false
                notbuilt: false

    builders:
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-perf-verify.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot:
            output-path: archive
            other-files:
              - '*.*'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-nsh_sfc-verify-perf-{stream}'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - os-parameter:
            os: 'ubuntu1604'
        - stream-parameter:
            stream: '{stream}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers-non-activity-timeout:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'csit_nsh_sfc_perf_{stream}'

    builders:
        - shell:
            !include-raw-escape: jjb/csit/include-raw-csit-nsh_sfc-perf-hw.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot-report:
            output-path: 'archive'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-nsh_sfc-verify-func-{stream}-{os}-virl'

    project-type: freestyle
    node: '{os}-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - os-parameter:
            os: '{os}'
        - stream-parameter:
            stream: '{stream}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'csit_nsh_sfc_func_{stream}'

    builders:
        - shell:
            !include-raw-escape: include-raw-csit-nsh_sfc-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot-report:
            output-path: 'archive'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-tldk-verify-func-{stream}-{os}-virl'

    project-type: freestyle
    node: '{os}-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'
        - os-parameter:
            os: '{os}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'csit_verify_tldk_func'

    builders:
        - shell:
            !include-raw-escape: include-raw-csit-tldk-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'archive/*.*'
            latest-only: false

        - robot-report:
            output-path: 'archive'

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- job-template:
    name: 'csit-dmm-functional-{stream}-ubuntu1604-virl'

    project-type: freestyle
    node: 'ubuntu1604-basebuild-4c-4g'
    concurrent: true

    logrotate:
        daysToKeep: '{build-days-to-keep}'
        numToKeep: '{build-num-to-keep}'
        artifactDaysToKeep: '{build-artifact-days-to-keep}'
        artifactNumToKeep: '{build-artifact-num-to-keep}'

    parameters:
        - project-parameter:
            project: '{project}'
        - gerrit-parameter:
            branch: '{branch}'

    scm:
        - gerrit-trigger-scm:
            credentials-id: 'jenkins-gerrit-credentials'
            refspec: '$GERRIT_REFSPEC'
            choosing-strategy: 'gerrit'

    wrappers:
        - fdio-infra-wrappers:
            build-timeout: '{build-timeout}'

    triggers:
        - gerrit-trigger-manually-triggered:
            name: '{project}'
            branch: '{branch}'
            comment-trigger-value: 'csit_verify_dmm_func'

    builders:
        - shell:
            !include-raw-escape: include-raw-csit-dmm-functional-virl.sh

    publishers:
        - archive-artifacts:
            artifacts: 'report.html, log.html, output.xml'
            latest-only: false

        - robot-report:
            output-path: ''

        - fdio-infra-shiplogs:
            maven-version: 'mvn33-new'

- parameter:
    name: test-type-parameter
    parameters:
        - string:
            name: TYPE
            default: '{type}'
            description: "Test TYPE parameter if not given by trigger"
