{
  "comments": [
    {
      "unresolved": false,
      "key": {
        "uuid": "86cb52ad_6eeb9b3b",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T08:12:49Z",
      "side": 1,
      "message": "jjb-deploy ci-management-jjb-deploy-job",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "1f58f29b_81878be0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T10:09:58Z",
      "side": 1,
      "message": "jjb-deploy ci-management-jjb-deploy-job",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "d731383c_0d7f9b1d",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T15:32:36Z",
      "side": 1,
      "message": "As far as I can tell, this will work correctly.\nStill, I would prefer having [2] (and also [3]) merged to global-jjb first, then making this change use the newer global-jjb commit, and then using the following process to test the upgrade on Sandbox:\n1. Use production deploy job to create deploy job on Sandbox.\n1.1. Make any manual changes to needed for jobs to run correctly on Sandbox.\n2. Use deploy job on Sandbox to update the same deploy job on Sandbox.\n3. Look at deploy job history, specifically the diff between production-deployed  and sandbox-deployed configuration.\n3.1. Make any manual changes again.\n4. Use the new Sandbox deploy job configuration to create few other jobs on Sandbox.\n5. Test that those jobs work as expected (after required manual changes).\n\nAfter that, merging this (new production job configurations, created using jjb 5.0.2) and remerging (updated production job configurations, created using jjb 6.0.0) should finish the upgrade process (assuming the first merge does not fail).\n\nI am not sure why the previous attempt [4] failed, as otherwise there is not much difference between this and that.\n\n[2] 72775: Fix: update submodules in jjb-deploy-job | https://gerrit.linuxfoundation.org/infra/c/releng/global-jjb/+/72775\n[3] 72776: Fix: Add comment as parameter to deploy job | https://gerrit.linuxfoundation.org/infra/c/releng/global-jjb/+/72776\n[4] https://gerrit.fd.io/r/c/ci-management/+/40403",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "4affbc1c_6f3a6558",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T15:32:48Z",
      "side": 1,
      "message": "reverify",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "e987778a_c5c61290",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T17:18:09Z",
      "side": 1,
      "message": "jjb-deploy vpp-csit-verify-device-master-ubuntu2204-aarch64-1n-alt",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "09bea041_9bb80cef",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 1263
      },
      "writtenOn": "2024-04-02T17:42:36Z",
      "side": 1,
      "message": "\u003e As far as I can tell, this will work correctly.\n\u003e 1. Use production deploy job to create deploy job on Sandbox.\n\u003e 1.1. Make any manual changes to needed for jobs to run correctly on Sandbox.\n\u003e 2. Use deploy job on Sandbox to update the same deploy job on Sandbox.\n\u003e I am not sure why the previous attempt [4] failed\n\nOk, I think now I understand better. Due to missing [2], step 1 happens to work correctly, and even ci-verify job manually started with 6.0.0 does not check the mangled bash scripts.\n\nFinally, using this production deploy run [5] has caused a bad change in previously well configured (by the above 1-5 step process) visible here [6].\n\nThe conclusion this step:\n  merging this (new production job configurations, created using jjb 5.0.2)\nwill break all jobs (incliding ci-merge) again.\n\nSo this change (after we verify again after [2]) is good by itself, but it needs a specific way to apply:\n6. Merge this, but...\n7. Immediately cancel the scheduled ci0merge run to avoid breakage.\n8. Start the ci-merge job manually with jjb-version set to 6.0.0.\n\nAlternatively, fix the issues described in here [7].\n\n[5] https://jenkins.fd.io/job/ci-management-jjb-deploy-job/80/parameters/\n[6] https://jenkins.fd.io/sandbox/job/vpp-csit-verify-device-master-ubuntu2204-aarch64-1n-alt/jobConfigHistory/showDiffFiles?timestamp1\u003d2024-04-02_16-51-23\u0026timestamp2\u003d2024-04-02_17-28-24\n[7] https://lists.linuxfoundation.org/pipermail/lf-releng/2024-March/000362.html",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "5329712b_29bae3f6",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 663
      },
      "writtenOn": "2024-04-03T03:27:07Z",
      "side": 1,
      "message": "Yes, you are right! Since JJB 6x is not backward compatible we\u0027ll have to either clean up the jobs on Jenkins with 5x and upload all the jobs configs with 6x.\nThe job configs should not change once the JJB merge completes successfully with 6x.\n\nI believe the jobs that have started would not be impacted since they should already have a snapshot of the config trigger with JJB 5x. However with 6x to be sure that, the job queued should be canceled or restarted once the JJB configs with 6x are completed. The previous issues occurred since the JJB merge was not completed successfully and the change in question was reverted before the merge was completed. \n\nThis change specifically requires running the JJB merge twice. A \"remerge\" comment on the CR should be good enough to rerun the JJB merge with JJB version 6.0.0 on the second run. \n\nI propose the following approach:\n1. +2 the CR (Do not submit)\n2. Put Jenkins on shutdown mode.\n3. Manually update the JJB-merge job configs to pick up JJB 6x\n4. Cancel the JJB merge job and with running a \"remrge\" on the CR to pick up the most recent change.\n5. Re-run JJB-merge with 6x and other test jobs to ensure the upgrade is completed successfully.\n\nWill wait of your confirmation before proceeding with the update. PS Note: All of LF projects are updated to JJB 6x.",
      "parentUuid": "09bea041_9bb80cef",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "16dd21a7_ce79e0f0",
        "filename": "/PATCHSET_LEVEL",
        "patchSetId": 1
      },
      "lineNbr": 0,
      "author": {
        "id": 663
      },
      "writtenOn": "2024-04-03T10:35:42Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "5329712b_29bae3f6",
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": true,
      "key": {
        "uuid": "f480cd2c_6c87186a",
        "filename": "jjb/global-macros.yaml",
        "patchSetId": 1
      },
      "lineNbr": 875,
      "author": {
        "id": 10
      },
      "writtenOn": "2024-04-02T16:15:57Z",
      "side": 1,
      "message": "This change is breaks the bash scripts which upload artifacts to AWS S3.  Please remove all of these changes in this file and retest to identify why they are necessary.  I do not see a reason for these changes to be required.",
      "range": {
        "startLine": 875,
        "startChar": 25,
        "endLine": 875,
        "endChar": 44
      },
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    },
    {
      "unresolved": false,
      "key": {
        "uuid": "5578f80e_d8c527ce",
        "filename": "jjb/global-macros.yaml",
        "patchSetId": 1
      },
      "lineNbr": 875,
      "author": {
        "id": 663
      },
      "writtenOn": "2024-04-03T10:35:55Z",
      "side": 1,
      "message": "Done",
      "parentUuid": "f480cd2c_6c87186a",
      "range": {
        "startLine": 875,
        "startChar": 25,
        "endLine": 875,
        "endChar": 44
      },
      "revId": "9df51f0fc73d0904c201e707f0bbf7d36a3fd5e6",
      "serverId": "6d2eb258-4fe2-443e-8a38-ca81da23d4c2"
    }
  ]
}